/*! sagyChart 2014-02-21 */
window.unitDocs={Wh:{lowerLevel:null,higherLevel:"kWh",ratio:1e3},kWh:{lowerLevel:"Wh",higherLevel:"MWh",ratio:1e3},MWh:{lowerLevel:"kWh",higherLevel:"GWh",ratio:1e3},GWh:{lowerLevel:"MWh",higherLevel:"TWh",ratio:1e3},TWh:{lowerLevel:"GWh",higherLevel:"PWh",ratio:1e3},PWh:{lowerLevel:"TWh",higherLevel:"EWh",ratio:1e3},EWh:{lowerLevel:"PWh",higherLevel:"ZWh",ratio:1e3},ZWh:{lowerLevel:"EWh",higherLevel:"YWh",ratio:1e3},YWh:{lowerLevel:"ZWh",higherLevel:null,ratio:1e3},W:{lowerLevel:null,higherLevel:"kW",ratio:1e3},kW:{lowerLevel:"W",higherLevel:"MW",ratio:1e3},MW:{lowerLevel:"kW",higherLevel:"GW",ratio:1e3},GW:{lowerLevel:"MW",higherLevel:"TW",ratio:1e3},TW:{lowerLevel:"GW",higherLevel:"PW",ratio:1e3},PW:{lowerLevel:"TW",higherLevel:"EW",ratio:1e3},EW:{lowerLevel:"PW",higherLevel:"ZW",ratio:1e3},ZW:{lowerLevel:"EW",higherLevel:"YW",ratio:1e3},YW:{lowerLevel:"ZW",higherLevel:null,ratio:1e3},"元":{lowerLevel:null,higherLevel:"万元",ratio:1e3},"万元":{lowerLevel:"元",higherLevel:"亿元",ratio:1e3},"亿元":{lowerLevel:"万元",higherLevel:null,ratio:1e3},g:{lowerLevel:null,higherLevel:"kg",ratio:1e3},kg:{lowerLevel:"g",higherLevel:null,ratio:1e3},T:{lowerLevel:"kg",higherLevel:null,ratio:1e3},J:{lowerLevel:null,higherLevel:"kJ",ratio:1e3},kJ:{lowerLevel:"J",higherLevel:"MJ",ratio:1e3},MJ:{lowerLevel:"kJ",higherLevel:null,ratio:1e3},L:{lowerLevel:null,higherLevel:"T",ratio:1e3},"m³":{lowerLevel:"L",higherLevel:null,ratio:1e3}},function(a,b){function c(a){return"string"==typeof a}function d(a){return"[object Array]"===w.call(a)}function e(a){return"[object Function]"===w.call(a)}function f(a){return"number"==typeof a}function g(a){var b;for(b in a)return!1;return!0}function h(){return"sagy"+E().toString(36).substring(2,6)}function i(a){throw new Error(a)}function j(a){console.log(a)}function k(a,b){var c,e,f=0;if(a){if(d(a))for(e=a.length;e>f&&(c=b.call(a[f],f,a[f]),c!==!1);f++);else for(f in a)if(c=b.call(a[f],f,a[f]),c===!1)break;return a}}function l(a,b){var c;a||(a={});for(c in b)a[c]=b[c];return a}function m(){var a,b=arguments.length,c={},d=function(a,b){var c,e;"object"!=typeof a&&(a={});for(e in b)b.hasOwnProperty(e)&&(c=b[e],a[e]=c&&"object"==typeof c&&"[object Array]"!==w.call(c)&&"number"!=typeof c.nodeType?d(a[e]||{},c):b[e]);return a};for(a=0;b>a;a++)c=d(c,arguments[a]);return c}function n(a){return a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0),a.getTime()}function o(a,b){var c,d,e=parseFloat(a),f=!1;return isNaN(e)?b?null:"--":(0>e&&(f=!0,e*=-1),c=e>=1e4?1:e>=1e3?10:e>=100?100:e>=10?1e3:1e4,e=D(e*c)/c,b?e:(d=e>=1e5?e.toExponential(1):e.toString(),f&&(d="-"+d),d))}function p(a,b){a&&(this.x=a),this.y=b}function q(a,b){var c,d=h();return c=x.createElement("div"),c.setAttribute("id",d),b.appendChild(c),a.chart.renderTo=d,new Highcharts.Chart(a)}function r(a,b){var c=b||1;switch(!0){case 10*y*c>=a:return 1;case a>10*y*c&&z*c>=a:return 2;case a>z*c&&A*c>=a:return 3;case a>A*c&&B*c>=a:return 4;case a>B*c:return 5;default:return 2}}function s(a,b){return function(){b[a].apply(b,arguments)}}function t(){this.init.apply(this,arguments)}var u="0.8.2",v={},w=v.toString,x=a.document,y=6e4,z=60*y,A=24*z,B=7*A,C=Math,D=C.round,E=C.random,F=C.max,G=C.min,H=C.pow,I=a.unitDocs,J=function(){var a=arguments,b=a[0],d=a[1];return c(b)&&(b={renderTo:a[0]}),new J.fn.init(b,d)},K=function(){var a=this.series.chart;a.hoverPoint&&L.call(this),a.svg_yRect=a.renderer.image(a.resourcePath+"panel_Y.png",a.plotLeft-80,this.plotY+a.plotTop-21,80,50).attr({fill:"white",zIndex:99}).add();var b,c=o(this.y),d=c.length>4?20:28,e=d+"px";switch(a.svg_yText=a.renderer.text(c,a.plotLeft-43,this.plotY+a.plotTop+d/2).attr({zIndex:100,"text-anchor":"middle"}).css({color:"white",fontSize:e}).add(),a.svg_xRect=a.renderer.image(a.resourcePath+"panel_X.png",a.plotLeft+this.plotX-52,a.plotTop+a.plotHeight,102,60).attr({fill:"white",zIndex:99}).add(),a.timeType){case 1:b=Highcharts.dateFormat("%H:%M",this.x);break;case 2:b=Highcharts.dateFormat("%H:%M",this.x);break;case 3:case 4:b=Highcharts.dateFormat("%m.%d",this.x);break;case 5:b=Highcharts.dateFormat("%m",this.x);break;default:b=Highcharts.dateFormat("%H:%M",this.x)}a.svg_xText=a.renderer.text(b,a.plotLeft+this.plotX,a.plotTop+a.plotHeight+45).attr({zIndex:100,"text-anchor":"middle"}).css({color:"white",fontSize:"32px"}).add(),a.hoverPoint=this},L=function(){var a=this.series.chart;a.svg_xText&&(a.svg_xText.destroy(),a.svg_xRect.destroy(),a.svg_yText.destroy(),a.svg_yRect.destroy(),a.svg_xText=null,a.svg_xRect=null,a.svg_yText=null,a.svg_yRect=null),a.hoverPoint=null},M=function(){var a,b=this.chart;switch(b.timeType){case 1:b.recentLength<15&&(a=b.series[0].xData);break;case 3:case 4:b.recentLength<30&&(a=b.series[0].xData);break;default:a=null}return a},N=function(){var a,b=this.chart,c=b.prev||"";switch(b.timeType){case 1:case 2:a=Highcharts.dateFormat("%H:%M",this.value);break;case 3:case 4:a=Highcharts.dateFormat("%m.%d",this.value);break;case 5:a=Highcharts.dateFormat("%m月",this.value);break;default:a=Highcharts.dateFormat("%H:%M",this.value)}return b.prev=a,a===c&&(a=""),a},O={chart:{backgroundColor:"rgba(255,0,0,0)",renderTo:"chart_container"},legend:{enabled:!1},credits:{enabled:!1},plotOptions:{series:{turboThreshold:2e5,stickyTracking:!0,shadow:!1}},title:{text:null},xAxis:{tickLength:0,tickWidth:0,lineWidth:0,title:{text:null}},yAxis:{tickWidth:0,lineWidth:0,title:{text:null}}},P={chartOption:O,renderTo:"",resourcePath:"./images/sagyChart/",autoAxis:!0,autoTooltip:!0,subline:{enabled:!1,lines:[],renderTo:"",deviation:0},convertUnit:{enabled:!0,consistent:!1},ajaxOption:{url:"./chart",transferData:{},index:0,callback:null,pointHandler:null,isJson:!0}};J.fn=J.prototype={sagyChart:u,constructor:J,init:function(a,b){var c,d,f,g,h=this;a.chartOption||i("chartOption为必选项!"),a.chartOption=m(O,a.chartOption),c=m(P,a),c.autoAxis&&(c.chartOption.xAxis.labels.formatter=N,c.chartOption.xAxis.tickPositioner=M),c.autoTooltip&&(c.chartOption.plotOptions.series.point.events.mouseOver.mouseOut=K,c.chartOption.plotOptions.series.point.events.mouseOut=L),d=x.getElementById(c.renderTo),d||i("页面不存在id为"+c.renderTo+"的元素"),h.subline=g=new t(h,c.subline),h.showLine=s("show",g),h.hideLine=s("hide",g),h.adjustLine=s("adjust",g),f=q(c.chartOption,d),f.resourcePath=c.resourcePath,h.options=c,h.chart=f,h.transferData=c.ajaxOption.transferData,h.version=u,e(b)&&b.call(h)},refresh:function(a,b){var c,d,f,g=this,h=g.options.ajaxOption;a&&(d=a.transferData?a:{transferData:a},c=m(h.transferData,d.transferData),h=m(h,d),h.transferData=c,g.options.ajaxOption=h),f=b?b:h.callback,$.ajax({type:"POST",datatype:"json",data:h.isJson?h.transferData:JSON.stringify(h.transferData),url:h.url,success:function(a){var b;a&&a.yData&&0!==a.yData.length?(g.setData(a,h.index),b=!0):(g.clearData(h.index),j("ajax:"+h.url+" return null"),b=!1),e(f)&&f.call(g,b)},error:function(){i("ajax:"+h.url+" error!")}})},setData:function(a,c){var d,f,h,i,j,l,m,o=this,q=o.subline,s=q.lines,t=o.chart,u=o.options,v=u.ajaxOption.pointHandler,w=c===b?u.ajaxOption.index:u.ajaxOption.index=c,x=t.series,y=x.length,A=a.xData,B=a.yData,E=B.length,H=!!A,I=0,J=[],K=!0;if(H){for(;I<B.length-1&&null===B[I]||null===B[I+1];)I++;t.timeType=I>=B.length?6:r(A[I+1]-A[I],u.axisRatio),t.recentLength=A.length}for(u.subline.enabled&&k(a.lines,function(a,b){s[a].value=b.value}),u.convertUnit.enabled&&(i=o.convertUnitArr(B,a.unit),o.unit=i.unit,B=i.data),l=B.filter(function(a){return null!==a}),f=G.apply(C,l),h=F.apply(C,l),I=E-1;I>=0;I--)H&&(m&&m-A[I]>2*z&&(d=new p(A[I]+2*z,null),J.unshift(d)),m=null===B[I]?null:A[I]),d=new p(H?A[I]:null,B[I]),e(v)&&(d.isMin=d.y===f,d.isMax=d.y===h,H&&K&&null!==d.y&&d.x>n(new Date)?(K=!1,d.isLast=!0):d.isLast=!1,v.call(d,o.options.ajaxOption)),d.y=null===d.y?null:D(100*d.y)/100,J.unshift(d);w=w>y||-1*y>w?y-1:w,j=+w+(0>w?y:0),x[j]?x[j].setData(J):t.addSeries({data:J}),g(q.showed)||o.adjustLine()},clearData:function(a,b){var c,d=this.chart.series,e=d.length;a=a>e||-1*e>a?e-1:a,c=+a+(0>a?e:0),b?d[c].destroy():d[c].setData(null)},destroy:function(){var a=this;a.chart.destroy(),a.chart=null,x.getElementById(a.options.renderTo).innerHTML=""},redraw:function(){var a=this;a.chart=new Highcharts.Chart(a.options.chartOption),a.refresh()}},J.fn.init.prototype=J.fn,J.fn.convertUnitArr=function(a,b){var c,d,e=this.options.convertUnit,f=this.subline,h=F.apply(C,a),i=I[b],j=b,l=10>h?-1:0,m=h,n=i,o=[];if(!i)return{data:a,unit:b};if(c=i.ratio,0===l)for(;m>=10*c&&(m/=c,I[n.higherLevel]);)j=n.higherLevel,l++,n=I[n.higherLevel];else j=i.lowerLevel;for(e.consistent&&e.convertedUnit?(j=e.convertedUnit,l=e.convertedLen):(e.convertedUnit=j,e.convertedLen=l),d=0;d<a.length;d++)null===a[d]?o.push(null):o.push(a[d]*H(c,-1*l));return g(f.showed)||k(f.lines,function(a,b){b.convertedValue=b.value*H(c,-1*l)}),{data:o,unit:j}},t.prototype={constructor:t,init:function(a,b){var c=this,d=b.lines;b.renderTo&&(c.node=x.getElementById(b.renderTo)),k(d,function(a,b){b.node=b.renderTo?x.getElementById(b.renderTo):c.node}),c.sagy=a,c.options=b,c.lines=d,c.showed={}},show:function(){var a=arguments,b=this,c=b.lines,d=b.showed;0===a.length?k(c,function(a,b){d["line"+a]=b,b.node&&(b.node.style.display="block")}):f(a[0])?k(a,function(a,b){d["line"+b]=c[b],c[b].node&&(c[b].node.style.display="block")}):k(a[0],function(a,b){d["line"+a]=c[a]=m(c[a],b),c[a].node&&(c[a].node.style.display="block")}),b.adjust()},hide:function(a){var b=this,c=b.sagy.chart.yAxis,d=b.showed;a=~~a,k(d,function(b){c[a].removePlotLine(b),d[b].node&&(d[b].node.style.display="none")}),d={}},adjust:function(){var a,b=this,c=b.showed,d=b.options.deviation,e=b.sagy.chart,f=e.plotTop,g=e.plotSizeY,h=e.yAxis;k(c,function(b,c){a=h[~~c.index],a.removePlotLine(b)}),k(c,function(b,c){var e,i,j,k=c.convertedValue||c.value;a=h[~~c.index],a.addPlotLine({color:c.color,dashStyle:"Solid",width:2,value:k,id:b,zIndex:99}),c.node&&(i=c.node,k>a.max?i.style.top=f-i.scrollHeight/2+d+"px":k<a.min?i.style.top=f+g-i.scrollHeight/2+d+"px":(j=a.plotLinesAndBands[a.plotLinesAndBands.length-1].svgElem,j.shadow(!0),e=j.d,f=e.split(" ",3)[2],i.style.top=f-i.scrollHeight/2+d+"px"))})}},J.numFormat=o,J.version=u;var Q=function(){return this instanceof Q?(this._fired={},this._callbacks={},void 0):Q()},R=function(){var a,b,c,d,f,g,h=this,i=0,j=arguments.length,k=0,l={};if(3>j)return h;if(f=Array.prototype.slice.apply(arguments,[0,j-2]),d=arguments[j-2],g=arguments[j-1],!e(d))return h;for(a=f.length,b=function(a){var b=g?"once":"bind";h[b](a,function(b){h._fired[a]=h._fired[a]||{},h._fired[a].data=b,l[a]||(l[a]=!0,k++)})},i=0;a>i;i++)b(f[i]);c=function(b){if(!(a>k)&&l[b]){var e=[];for(i=0;a>i;i++)e.push(h._fired[f[i]].data);g&&h.removeListener("all",c),d.call(null,e)}},h.addListener("all",c)};l(Q.prototype,{addListener:function(a,b){return this._callbacks=this._callbacks||{},this._callbacks[a]=this._callbacks[a]||[],this._callbacks[a].push(b),this},removeListener:function(a,b){var c,d,e,f=this._callbacks;if(a){if(f)if(b){if(c=f[a],!c)return this;for(e=c.length,d=0;e>d;d++)if(b===c[d]){c[d]=null;break}}else f[a]=[]}else this._callbacks={};return this},trigger:function(a){for(var b,c,d,e,f,g,h=2,i=this._callbacks;h--;)if(c=h?a:"all",b=i[c])for(f=0,g=b.length;g>f;f++)(d=b[f])?(e=h?Array.prototype.slice.call(arguments,1):arguments,d.apply(this,e)):(b.slice(f,1),f--,g--);return this},once:function(a,b){var c=this,d=function(){b.apply(c,arguments),c.removeListener(a,d)};return c.addListener(a,d),c},all:function(){var a=Array.prototype.concat.apply([],arguments);return a.push(!0),R.apply(this,a),this},removeAll:function(a){return this.removeListener(a)}}),Q.prototype.on=Q.prototype.addListener,Q.prototype.fire=Q.prototype.trigger,Q.prototype.unbind=Q.prototype.removeListener,"object"==typeof a&&"object"==typeof a.document&&(a.sagyChart=J,a.AsynTool=Q)}(window);