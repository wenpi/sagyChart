/*! sagyChart 2013-08-28 */
window.unitDocs={Wh:{lowerLevel:null,higherLevel:"kWh",ratio:1e3},kWh:{lowerLevel:"Wh",higherLevel:"MWh",ratio:1e3},MWh:{lowerLevel:"kWh",higherLevel:"GWh",ratio:1e3},GWh:{lowerLevel:"MWh",higherLevel:"TWh",ratio:1e3},TWh:{lowerLevel:"GWh",higherLevel:"PWh",ratio:1e3},PWh:{lowerLevel:"TWh",higherLevel:"EWh",ratio:1e3},EWh:{lowerLevel:"PWh",higherLevel:"ZWh",ratio:1e3},ZWh:{lowerLevel:"EWh",higherLevel:"YWh",ratio:1e3},YWh:{lowerLevel:"ZWh",higherLevel:null,ratio:1e3},W:{lowerLevel:null,higherLevel:"kW",ratio:1e3},kW:{lowerLevel:"W",higherLevel:"MW",ratio:1e3},MW:{lowerLevel:"kW",higherLevel:"GW",ratio:1e3},GW:{lowerLevel:"MW",higherLevel:"TW",ratio:1e3},TW:{lowerLevel:"GW",higherLevel:"PW",ratio:1e3},PW:{lowerLevel:"TW",higherLevel:"EW",ratio:1e3},EW:{lowerLevel:"PW",higherLevel:"ZW",ratio:1e3},ZW:{lowerLevel:"EW",higherLevel:"YW",ratio:1e3},YW:{lowerLevel:"ZW",higherLevel:null,ratio:1e3},"元":{lowerLevel:null,higherLevel:"万元",ratio:1e3},"万元":{lowerLevel:"元",higherLevel:"亿元",ratio:1e3},"亿元":{lowerLevel:"万元",higherLevel:null,ratio:1e3},g:{lowerLevel:null,higherLevel:"kg",ratio:1e3},kg:{lowerLevel:"g",higherLevel:null,ratio:1e3},T:{lowerLevel:"kg",higherLevel:null,ratio:1e3},J:{lowerLevel:null,higherLevel:"kJ",ratio:1e3},kJ:{lowerLevel:"J",higherLevel:"MJ",ratio:1e3},MJ:{lowerLevel:"kJ",higherLevel:null,ratio:1e3},L:{lowerLevel:null,higherLevel:"T",ratio:1e3},"m³":{lowerLevel:"L",higherLevel:null,ratio:1e3}},function(a){function b(a){return"string"==typeof a}function c(a){return"[object Array]"===u.call(a)}function d(a){return"[object Function]"===u.call(a)}function e(a){return"number"==typeof a}function f(a){var b;for(b in a)return!1;return!0}function g(){return"sagy"+C().toString(36).substring(2,6)}function h(a){throw new Error(a)}function i(a){console.log(a)}function j(a,b){var d,e,f=0;if(a){if(c(a))for(e=a.length;e>f&&(d=b.call(a[f],f,a[f]),d!==!1);f++);else for(f in a)if(d=b.call(a[f],f,a[f]),d===!1)break;return a}}function k(a,b){var c;a||(a={});for(c in b)a[c]=b[c];return a}function l(){var a,b=arguments.length,c={},d=function(a,b){var c,e;"object"!=typeof a&&(a={});for(e in b)b.hasOwnProperty(e)&&(c=b[e],a[e]=c&&"object"==typeof c&&"[object Array]"!==u.call(c)&&"number"!=typeof c.nodeType?d(a[e]||{},c):b[e]);return a};for(a=0;b>a;a++)c=d(c,arguments[a]);return c}function m(a,b){this.x=a,this.y=b}function n(a){var b,c,d=parseFloat(a),e=!1;return isNaN(d)?"":(0>d&&(e=!0,d*=-1),b=d>=1e4?1:d>=1e3?10:d>=100?100:d>=10?1e3:1e4,d=B(d*b)/b,c=d>=1e5?d.toExponential(1):d.toString(),e&&(c="-"+c),c)}function o(a,b){var c,d=g();return c=v.createElement("div"),c.setAttribute("id",d),c.style.height="100%",c.style.width="100%",b.appendChild(c),a.chart.renderTo=d,new Highcharts.Chart(a)}function p(a){switch(!0){case 10*w>=a:return 1;case a>10*w&&x>=a:return 2;case a>x&&y>=a:return 3;case a>y&&z>=a:return 4;case a>z:return 5;default:return 2}}function q(a,b){return function(){b[a].apply(b,arguments)}}function r(){this.init.apply(this,arguments)}var s="0.0.5",t={},u=t.toString,v=(t.hasOwnProperty,a.document),w=6e4,x=60*w,y=24*x,z=7*y,A=Math,B=A.round,C=A.random,D=(A.floor,A.ceil,A.max),E=A.min,F=(A.abs,A.pow),G=a.unitDocs,H=function(){var a=arguments,c=a[0],d=a[1];return b(c)&&(c={renderTo:a[0],template:"a"}),new H.fn.init(c,d)},I={template:"a",chartOption:{},renderTo:"",resourcePath:"./images/sagyChart/",subline:{enabled:!1,lines:[{value:0,color:"#87B6FE",name:"参考值"},{value:100,color:"#87B6FE",name:"报警值"}],renderTo:"sagyChart_sublime",deviation:22},convertUnit:{enabled:!0,consistent:!1},ajaxOption:{url:"./chart",transferData:{},index:0,callback:null,pointHandler:null}},J=function(){var a=this.series.chart;a.hoverPoint&&K.call(this),a.svg_yRect=a.renderer.image(a.resourcePath+"panel_Y.png",a.plotLeft-80,this.plotY+a.plotTop-21,80,50).attr({fill:"white",zIndex:99}).add();var b,c=n(this.y),d=c.length>4?20:30,e=d+"px";switch(a.svg_yText=a.renderer.text(c,a.plotLeft-42,this.plotY+a.plotTop+d/2).attr({zIndex:100,"text-anchor":"middle"}).css({color:"white",fontSize:e}).add(),a.svg_xRect=a.renderer.image(a.resourcePath+"panel_X.png",a.plotLeft+this.plotX-52,a.plotTop+a.plotHeight,102,60).attr({fill:"white",zIndex:99}).add(),a.timeType){case 1:b=Highcharts.dateFormat("%H:%M",this.x);break;case 2:b=Highcharts.dateFormat("%H:%M",this.x);break;case 3:case 4:b=Highcharts.dateFormat("%m.%d",this.x);break;case 5:b=Highcharts.dateFormat("%m",this.x)}a.svg_xText=a.renderer.text(b,a.plotLeft+this.plotX,a.plotTop+a.plotHeight+45).attr({zIndex:100,"text-anchor":"middle"}).css({color:"white",fontSize:"32px"}).add(),a.hoverPoint=this},K=function(){var a=this.series.chart;a.svg_xText&&(a.svg_xText.destroy(),a.svg_xRect.destroy(),a.svg_yText.destroy(),a.svg_yRect.destroy(),a.svg_xText=null,a.svg_xRect=null,a.svg_yText=null,a.svg_yRect=null),a.hoverPoint=null},L=function(){var a,b=this.chart;switch(b.timeType){case 1:b.recentLength<15&&(a=b.series[0].xData);break;case 3:case 4:b.recentLength<30&&(a=b.series[0].xData);break;default:a=null}return a},M=function(){var a,b=this.chart,c=b.prev||"";switch(b.timeType){case 1:case 2:a=Highcharts.dateFormat("%H:%M",this.value);break;case 3:case 4:a=Highcharts.dateFormat("%m.%d",this.value);break;case 5:a=Highcharts.dateFormat("%m月",this.value)}return b.prev=a,a===c&&(a=""),a},N={a:{chart:{backgroundColor:"rgba(255,0,0,0)",spacingBottom:20,marginRight:110,marginLeft:110,spacingLeft:0,renderTo:"chart_container",height:650,plotBorderWidth:1,plotBackgroundColor:"#fffff9"},legend:{enabled:!1},credits:{enabled:!1},plotOptions:{connectNulls:!1,series:{stickyTracking:!1,pointPadding:0,borderWidth:0,groupPadding:.1,pointPlacement:"on",shadow:!1,point:{events:{mouseOver:J,mouseOut:K}}}},tooltip:{enabled:!0,animation:!1,formatter:function(){return!1},crosshairs:[{x:!0,dashStyle:"ShortDash",width:1},{y:!0,dashStyle:"ShortDash",width:1,zIndex:10}]},title:{text:null},xAxis:{alternateGridColor:"rgba(242,253,242,0.5)",tickLength:0,tickWidth:0,gridLineColor:"#B2EAC7",gridLineDashStyle:"longDash",gridLineWidth:1,type:"datetime",title:{text:null},labels:{enabled:!0,style:{fontSize:20,fontFamily:"Arial",color:"#aaaaaa"},formatter:M},offset:25,lineWidth:0,tickPositioner:L},yAxis:{startOnTick:!1,tickPixelInterval:80,tickWidth:0,offset:150,alternateGridColor:"rgba(244,248,248,0.5)",gridLineColor:"#B2EAC7",gridLineDashStyle:"longDash",title:{text:null},lineWidth:0,labels:{align:"right",enabled:!0,y:10,style:{fontSize:20,fontFamily:"Arial",color:"#aaaaaa"}}},series:[{turboThreshold:2e5,type:"column",color:"#e59c9b",data:[],connectNulls:!1,states:{hover:{enabled:!1}},shadow:!1,zIndex:8}]},b:{chart:{backgroundColor:"rgba(255,0,0,0)",spacingBottom:20,marginRight:110,marginLeft:110,spacingLeft:0,renderTo:"chart_container",height:650,plotBorderWidth:1,plotBackgroundColor:"#fffff9"},legend:{enabled:!1},credits:{enabled:!1},plotOptions:{connectNulls:!1,series:{stickyTracking:!0,shadow:!1,point:{events:{mouseOver:J,mouseOut:K}},marker:{enabled:!1,radius:7,lineColor:"white",lineWidth:2,symbol:"pointCircle"}}},tooltip:{enabled:!0,animation:!1,formatter:function(){return!1},crosshairs:[{x:!0,dashStyle:"ShortDash",width:1},{y:!0,dashStyle:"ShortDash",width:1}]},title:{text:null},xAxis:{alternateGridColor:"rgba(242,253,242,0.5)",tickLength:0,tickWidth:0,gridLineColor:"#B2EAC7",gridLineDashStyle:"longDash",gridLineWidth:1,type:"datetime",title:{text:null},labels:{enabled:!0,style:{fontSize:20,fontFamily:"Arial",color:"#aaaaaa"},formatter:M},offset:25,lineWidth:0,tickPositioner:L},yAxis:{startOnTick:!1,tickPixelInterval:80,tickWidth:0,offset:150,alternateGridColor:"rgba(244,248,248,0.5)",gridLineColor:"#B2EAC7",gridLineDashStyle:"longDash",title:{text:null},lineWidth:0,labels:{align:"right",enabled:!0,y:10,style:{fontSize:20,fontFamily:"Arial",color:"#aaaaaa"}}},series:[{turboThreshold:2e5,type:"line",color:"#25B4B1",data:[],connectNulls:!1,states:{hover:{enabled:!1}},shadow:!1,zIndex:8}]}};H.fn=H.prototype={sagyChart:s,constructor:H,init:function(a,c){var e,f,g,i,j,k=this;k.info={},b(a.template)&&(i=N[a.template],a.chartOption=i),e=l(I,a),f=v.getElementById(e.renderTo),f||h("given a wrong dom id!"),e.subline.enabled&&(k.subline=j=k.info.subline=new r(k,e.subline),k.showLine=q("show",j),k.hideLine=q("hide",j),k.adjustLine=q("adjust",j)),g=o(e.chartOption,f),g.resourcePath=e.resourcePath,k.options=e,k.chart=k.info.chart=g,k.version=s,d(c)&&c.call(k)},refresh:function(a,b){var c,e,f=this,g=f.options.ajaxOption;c=a.transferData?a:{transferData:a},a&&k(g,c),e=b?b:g.callback,$.ajax({type:"POST",datatype:"json",data:g.transferData,url:g.url,success:function(a){a&&0!==a.length?f.setData(a,g.index,g.pointHandler):(f.clearData(g.index),i("ajax:"+g.url+" return null"))},error:function(){i("ajax:"+g.url+" error!")},complete:function(a){if(d(e)){var b="OK"===a.statusText?!0:!1;e.call(f.info,b)}}})},setData:function(a,b,c){var e,g,h,i,k,l,n,o,q=this,r=q.subline,s=r.lines,t=q.chart,u=q.options,v=t.series,w=a.xData,x=a.yData,y=w.length,z=[],C=!0;for(t.timeType=p(w[1]-w[0]),t.recentLength=w.length,u.subline.enabled&&j(a.lines,function(a,b){s[a].value=b.value}),u.convertUnit.enabled&&(k=q.convertUnitArr(x,a.unit),q.info.unit=k.unit,x=k.data),o=x.filter(function(a){return null!==a}),h=E.apply(A,o),i=D.apply(A,o),e=y-1;e>=0;e--)g=new m(w[e],x[e]),d(c)&&(g.isMin=g.y===h,g.isMax=g.y===i,g.y&&C?(C=!1,g.isLast=!0):g.isLast=!1,c.call(g,q.options.ajaxOption.transferData)),g.y=B(100*g.y)/100,z.unshift(g);b=b>l||-1*l>b?l-1:b,n=+b+(0>b?l:0),v[n].setData(z),f(r.showed)||q.adjustLine()},clearData:function(a,b){var c,d=this.chart.series,e=d.length;a=a>e||-1*e>a?e-1:a,c=+a+(0>a?e:0),b?d[c].destroy():d[c].setData(null)},destroy:function(){var a=this;a.chart.destroy(),a.chart=null,a.info={},v.getElementById(a.options.renderTo).innerHTML=""},redraw:function(){var a=this;a.chart=new Highcharts.Chart(a.options.chartOption),a.refresh()}},H.fn.init.prototype=H.fn,H.fn.convertUnitArr=function(a,b){var c,d,e=this.options.convertUnit,g=this.subline,h=D.apply(A,a),i=G[b],k=b,l=10>h?-1:0,m=h,n=i,o=[];if(!i)return{data:a,unit:b};if(c=i.ratio,0===l)for(;m>=10*c&&(m/=c,G[n.higherLevel]);)k=n.higherLevel,l++,n=G[n.higherLevel];else k=i.lowerLevel;for(e.consistent&&e.convertedUnit?(k=e.convertedUnit,l=e.convertedLen):(e.convertedUnit=k,e.convertedLen=l),d=0;d<a.length;d++)null===a[d]?o.push(null):o.push(a[d]*F(c,-1*l));return f(g.showed)||j(g.lines,function(a,b){b.convertedValue=b.value*F(c,-1*l)}),{data:o,unit:k}},r.prototype={constructor:r,init:function(a,b){var c=this,d=b.lines;b.renderTo&&(c.node=v.getElementById(b.renderTo)),j(d,function(a,b){b.node=b.renderTo?v.getElementById(b.renderTo):c.node}),c.sagy=a,c.options=b,c.lines=d,c.showed={}},show:function(){var a=arguments,b=this,c=b.lines,d=b.showed;0===a.length?j(c,function(a,b){d["line"+a]=b,b.node&&(b.node.style.display="block")}):e(a[0])?j(a,function(a,b){d["line"+b]=c[b],c[b].node&&(c[b].node.style.display="block")}):j(a[0],function(a,b){d["line"+a]=c[a]=l(c[a],b),c[b].node&&(c[a].node.style.display="block")}),b.adjust()},hide:function(a){var b=this,c=b.sagy.chart.yAxis,d=b.showed;a=~~a,j(d,function(b){c[a].removePlotLine(b),d[b].node&&(d[b].node.style.display="none")}),d={}},adjust:function(){var a,b=this,c=(b.lines,b.showed),d=b.options.deviation,e=b.sagy.chart,f=e.plotTop,g=e.plotSizeY,h=e.yAxis;j(c,function(b,c){a=h[~~c.index],a.removePlotLine(b)}),j(c,function(b,c){var e,i,j,k=c.convertedValue||c.value;a=h[~~c.index],a.addPlotLine({color:c.color,dashStyle:"Solid",width:2,value:k,id:b,zIndex:99}),c.node&&(i=c.node,k>a.max?i.style.top=f-i.scrollHeight/2+d+"px":k<a.min?i.style.top=f+g-i.scrollHeight/2+d+"px":(j=a.plotLinesAndBands[a.plotLinesAndBands.length-1].svgElem,j.shadow(!0),e=j.d,f=e.split(" ",3)[2],i.style.top=f-i.scrollHeight/2+d+"px"))})}},H.numFormat=n,H.version=s;var O=function(){return this instanceof O?(this._fired={},this._callbacks={},void 0):O()},P=function(){var a,b,c,e,f,g,h=this,i=0,j=arguments.length,k=0,l={};if(3>j)return h;if(f=Array.prototype.slice.apply(arguments,[0,j-2]),e=arguments[j-2],g=arguments[j-1],!d(e))return h;for(a=f.length,b=function(a){var b=g?"once":"bind";h[b](a,function(b){h._fired[a]=h._fired[a]||{},h._fired[a].data=b,l[a]||(l[a]=!0,k++)})},i=0;a>i;i++)b(f[i]);c=function(b){if(!(a>k)&&l[b]){var d=[];for(i=0;a>i;i++)d.push(h._fired[f[i]].data);g&&h.removeListener("all",c),e.call(null,d)}},h.addListener("all",c)};k(O.prototype,{addListener:function(a,b){return this._callbacks=this._callbacks||{},this._callbacks[a]=this._callbacks[a]||[],this._callbacks[a].push(b),this},removeListener:function(a,b){var c,d,e,f=this._callbacks;if(a){if(f)if(b){if(c=f[a],!c)return this;for(e=c.length,d=0;e>d;d++)if(b===c[d]){c[d]=null;break}}else f[a]=[]}else this._callbacks={};return this},trigger:function(a){for(var b,c,d,e,f,g,h=2,i=this._callbacks;h--;)if(c=h?a:"all",b=i[c])for(f=0,g=b.length;g>f;f++)(d=b[f])?(e=h?Array.prototype.slice.call(arguments,1):arguments,d.apply(this,e)):(b.slice(f,1),f--,g--);return this},once:function(a,b){var c=this,d=function(){b.apply(c,arguments),c.removeListener(a,d)};return c.addListener(a,d),c},all:function(){var a=Array.prototype.concat.apply([],arguments);return a.push(!0),P.apply(this,a),this},removeAll:function(a){return this.removeListener(a)}}),O.prototype.on=O.prototype.addListener,O.prototype.fire=O.prototype.trigger,O.prototype.unbind=O.prototype.removeListener,"object"==typeof a&&"object"==typeof a.document&&(a.sagyChart=H,a.AsynTool=O)}(window);